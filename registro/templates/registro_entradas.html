{% extends "base.html" %}
{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {% block style %}
        <!-- Google Font: Source Sans Pro -->
        <link rel="stylesheet"
              href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="{% static 'css/fontawesome-free/css/all.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/estilos.css' %}">

        <!-- DataTables -->
        <link rel="stylesheet" href="{% static 'css/datatables-bs4/css/dataTables.bootstrap4.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/datatables-responsive/css/responsive.bootstrap4.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/datatables-buttons/css/buttons.bootstrap4.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/datatable-searchpanes/css/searchPanes.bootstrap4.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/datatable-select/css/select.bootstrap4.min.css' %}">

    {% endblock %}
    <!-- Theme style -->
    <link rel="stylesheet" href="{% static 'css/adminlte.min.css' %}">

</head>
<body class="hold-transition sidebar-mini">
<div class="wrapper">
    <!-- Navbar -->

    <!-- /.navbar -->

    <!-- Main Sidebar Container -->

    <!-- /.sidebar -->
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper" id="wrapper">
        <!-- Content Header (Page header) -->
        <!-- Main content -->
        <section class="content">
            {% block body %}
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12">
                            <div class="card">

                                <!-- /.card -->

                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Listado de documentos en entrada</h3>
                                    </div>
                                    <!-- /.card-header -->
                                    <div class="card-body mb-4" id="cardbody">
                                        <button class="button mb-2  " data-toggle="modal" data-target="#modal-default"
                                                id="agregar">Agregar Documento
                                        </button>
                                        <table id="tabla_entradas" class="table table-bordered table-striped">
                                            <thead>
                                            <tr>
                                                <th>No.</th>
                                                <th>Título</th>
                                                <th>Fecha entrada(s)</th>
                                                <th>Organismo</th>
                                                <th>Entidad</th>
                                                <th>Acciones</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for entradas in  list_entradas %}
                                                <tr>
                                                    <td>{{ entradas.no_registro }}</td>
                                                    <td>{{ entradas.titulo }}</td>
                                                    <td>{{ entradas.f_entrada_registro }}</td>
                                                    <td> {{ entradas.organismo }}</td>
                                                    <td> {{ entradas.entidad }}</td>
                                                    <td>
                                                        <div class="button btn-group inline-group">
                                                            <button type="button" data-toggle="modal"
                                                                    data-target="#detalles{{ entradas.pk }}"
                                                                    id="{{ entradas.pk }}"
                                                                    class="btn-sm btn-outline-info btn-floating "
                                                                    data-bs-toggle="tooltip" data-bs-placement="bottom"
                                                                    title="Mostrar documento">
                                                                <i class="fa fa-eye"></i>
                                                            </button>
                                                            <button type="button" id="editar_button" data-toggle="modal"
                                                                    data-target="#editar"
                                                                    class="btn btn-outline-dark btn-floating"
                                                                    data-bs-toggle="tooltip" data-bs-placement="top"
                                                                    title="Editar documento">
                                                                <i class="fa fa-edit"></i>
                                                            </button>
                                                            <button type="button" id="{{ entradas.pk }}"
                                                                    class="btn btn-outline-danger btn-floating"
                                                                    data-bs-toggle="tooltip" data-bs-placement="top"
                                                                    title="Eliminar documento">
                                                                <i class="fa fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <!-- /.modal-Detalles -->
                                                <div class="modal fade" id="detalles{{ entradas.pk }}">
                                                    <div id="alert-box"></div>
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <img src="{% static 'img/onrm.png' %}">
                                                                <h4 class="modal-title mx-auto mt-4">Detalles del
                                                                    Documento</h4>
                                                                <button type="button" class="close" data-dismiss="modal"
                                                                        aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <div class="form-group">
                                                                    <label class="form-label h5">Número de
                                                                        entrada en Registro:</label><br>
                                                                    {{ entradas.no_registro }}<br>
                                                                    <label class="form-label h5">Número de
                                                                        entrada en Documentación:</label><br>
                                                                    {{ entradas.no_entrada }}
                                                                    <h5 class="font-weight-bold mt-3">Título</h5>
                                                                    {{ entradas.titulo }}
                                                                    <h5 class="font-weight-bold mt-3">Fecha de
                                                                        entrada</h5>
                                                                    {{ entradas.f_entrada_registro}}
                                                                    <h5 class="font-weight-bold mt-3">Organismo</h5>
                                                                    {{ entradas.organismo }}
                                                                    <h5 class="font-weight-bold mt-3">Entidad</h5>
                                                                    {{ entradas.entidad }}<br>
                                                                    <h5 class="font-weight-bold mt-3">Provincia</h5>
                                                                    {{ entradas.provincia }}<br>
                                                                    <h5 class="font-weight-bold mt-3">Tipo de documento</h5>
                                                                    {{ entradas.t_documento }}
                                                                    <h5 class="font-weight-bold mt-3">Observaciones</h5>
                                                                    {{ entradas.observaciones }}
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- /.modal-content -->
                                                    </div>
                                                    <!-- /.modal-dialog -->
                                                </div>
                                                <!-- /.modal-editar -->
                                                <div class="modal fade" id="editar">
                                                    <div id="alert-box"></div>
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <img src="{% static 'img/onrm.png' %}">
                                                                <h4 class="modal-title mx-auto mt-4">Editar Documento</h4>
                                                                <button type="button" class="close" data-dismiss="modal"
                                                                        aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <form method="post" name="editar_documento" id="form_editar"  >
                                                                    {% csrf_token %}
                                                                    <input type="hidden" name="action" value="edit">
                                                                    <div class=" form-group" >
                                                                <input type="number" name="no_entrada_doc"
                                                                       class="form-control"
                                                                       label="Número de entrada"
                                                                       placeholder="Número consecutivo"
                                                                       style="max-width: 200px;" hidden required
                                                                       id="id_edit_no_entrada">
                                                                <h6 class="font-weight-bold mt-3">Titulo</h6>
                                                                <input type="text" name="titulo"
                                                                       class="form-control" label="Título"
                                                                       placeholder="Titulo documento"
                                                                       style="max-width: 500px;" maxlength="255"
                                                                       required="True" id="id_edit_titulo">
                                                                <h6 class="font-weight-bold mt-3">Fecha
                                                                    entrada a registro</h6>
                                                                <input type="date" name="f_entrada_doc"
                                                                       class="form-control"
                                                                       label="Fecha de entrada"
                                                                       style="max-width: 200px;" required
                                                                       id="id_edit_f_entrada_registo">

                                                                <h6 class="font-weight-bold mt-3">Organismo</h6>
                                                                <select name="organismo" class="form-control"
                                                                        label="Organismo:"
                                                                        style="max-width: 300px;" required=""
                                                                        id="id_edit_organismo">
                                                                   {% for organismo in list_organismos %}
                                                                   <option value="{{ organismo.pk }}"{% if organismo.id == id %} selected="selected"{% endif %}>{{ organismo }}
                                                                   </option>
                                                                    {% endfor %}
                                                                </select>
                                                                <h6 class="font-weight-bold mt-3">Entidad</h6>
                                                                <select name="entidad" class="form-control"
                                                                        label="Entidad:"
                                                                        style="max-width: 300px;" required=""
                                                                        id="id_edit_entidad">
                                                                    {% for entidades in list_entidad %}
                                                                   <option value="{{ entidades.pk }}"{% if entidades.id == id %} selected="selected"{% endif %}>{{ entidades }}
                                                                   </option>
                                                                    {% endfor %}
                                                                </select>
                                                                <h6 class="font-weight-bold mt-3">Provincia</h6>
                                                                <select name="organismo" class="form-control"
                                                                        label="Organismo:"
                                                                        style="max-width: 300px;" required=""
                                                                        id="id_edit_provincia">
                                                                   {% for provincia in list_provincias %}
                                                                   <option value="{{ provincia.pk }}"{% if provincia.id == id %} selected="selected"{% endif %}>{{ provincia }}
                                                                   </option>
                                                                    {% endfor %}

                                                                </select>
                                                                 <h6 class="font-weight-bold mt-3">Tipo de documento</h6>
                                                                <select name="t_documento" class="form-control"
                                                                        style="max-width: 300px;" required=""
                                                                        id="id_edit_t_documento">
                                                                    {% for tdoc in list_tipos_documentos %}
                                                                   <option value="{{ tdoc.pk }}"{% if tdoc.id == id %} selected="selected"{% endif %}>{{ tdoc }}
                                                                   </option>
                                                                    {% endfor %}
                                                                </select>
                                                                 <h6 class="font-weight-bold mt-3">
                                                                    Observaciones</h6>
                                                                <textarea name="observaciones" cols="40"
                                                                          rows="10" class="form-control"
                                                                          placeholder="Observaciones al documento"
                                                                          style="max-width: 500px;"
                                                                          maxlength="500"
                                                                          id="id_edit_observaciones"></textarea>
                                                            </div>
                                                            <div class="modal-footer mx-auto">

                                                                <button type="button" id="btnEditar"
                                                                        class="btn btn-outline-success">Editar
                                                                </button>
                                                                <button type="button" class="btn btn-default"
                                                                        data-dismiss="modal">Cerrar
                                                                </button>
                                                            </div>

                                                            </form>
                                                        </div>
                                                    </div>
                                                    <!-- /.modal-content -->
                                                </div>
                                                <!-- /.modal-dialog -->
                                                </div>
                                            {% endfor %}
                                    </tfoot>
                                    </table>
                                </div>
                                <!-- /.card-body -->
                            </div>
                            <!-- /.card -->
                        </div>
                        <!-- /.col -->
                    </div>
                    <!-- /.row -->
                </div>
                <!-- /.container-fluid -->
                </section>

                </div>
                <!-- Modal de agregar documentos junto son su alert -->
                <div class="modal fade" id="modal-default">
                    <div id="alert-box"></div>
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <img src="{% static 'img/onrm.png' %}">
                                <h4 class="modal-title mx-auto mt-4">Agregar Documento</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form method="post" name="agrega_documento" id="form_agregar">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="add">
                                    <div class="form-group">
                                        <label class="form-label">{{ form_entradas.no_registro.label }}</label>
                                        <h6 class="text-blue"> {% if no_registro.no_registro == null %}*El número tiene que ser el consecutivo
                                            de 0 {% else %}*El número tiene que ser el consecutivo de {{ no_registro.no_registro}} {% endif %}</h6>
                                       {{ form_entradas.no_registro }}
                                    <label class="form-label">{{ form_entradas.no_entrada.label }}</label>
                                       {{ form_entradas.no_entrada }}
                                        <h6 class="font-weight-bold mt-3">{{ form_entradas.titulo.label }}</h6>
                                        {{ form_entradas.titulo }}
                                        <h6 class="font-weight-bold mt-3">{{ form_entradas.f_entrada_registro.label }}</h6>
                                        {{ form_entradas.f_entrada_registro }}
                                        <h6 class="font-weight-bold mt-3">{{ form_entradas.organismo.label }}</h6>
                                        {{ form_entradas.organismo }}
                                        <h6 class="font-weight-bold mt-3">{{ form_entradas.entidad.label }}</h6>
                                        {{ form_entradas.entidad }}
                                        <h6 class="font-weight-bold mt-3">{{ form_entradas.provincia.label }}</h6>
                                        {{ form_entradas.provincia }}
                                        <label class="form-label mt-3">{{ form_entradas.t_documento.label }}</label>
                                        {{ form_entradas.t_documento }}
                                        <h6 class="font-weight-bold mt-3">{{ form_entradas.observaciones.label }}</h6>
                                        {{ form_entradas.observaciones }}
                                    </div>
                                    <div class="modal-footer mx-auto">
                                        <button type="submit" id="btnAceptar" class="btn btn-outline-primary">Agregar
                                        </button>
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar
                                        </button>
                                    </div>

                                </form>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div>
                <!-- /.modal -->
                <!-- Modal de detalles -->

                <!-- /.content -->
            {% endblock %}
    <!-- /.content-wrapper -->
    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
    </aside>
    <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->
{% block script %}
    <!-- jQuery -->
    <script src="{% static 'js/jquery/jquery.min.js' %}"></script>
    <!-- Bootstrap 4 -->
    <script src="{% static 'js/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'js/entradas.js' %}"></script>
    <!-- DataTables  & Plugins -->
    <script src="{% static 'js/datatables/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'css/datatables-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
    <script src="{% static 'css/datatables-responsive/js/dataTables.responsive.min.js' %}"></script>
    <script src="{% static 'css/datatables-responsive/js/responsive.bootstrap4.min.js' %}"></script>
    <script src="{% static 'css/datatables-buttons/js/dataTables.buttons.min.js' %}"></script>
    <script src="{% static 'css/datatables-buttons/js/buttons.bootstrap4.min.js' %}"></script>
    <script src="{% static 'js/jszip/jszip.min.js' %}"></script>
    <script src="{% static 'js/pdfmake/pdfmake.min.js' %}"></script>
    <script src="{% static 'js/pdfmake/vfs_fonts.js' %}"></script>
    <script src="{% static 'css/datatables-buttons/js/buttons.html5.min.js' %}"></script>
    <script src="{% static 'css/datatables-buttons/js/buttons.print.min.js' %}"></script>
    <script src="{% static 'css/datatables-buttons/js/buttons.colVis.min.js' %}"></script>
    <script src="{% static 'js/sweetalert2/sweetalert2.all.min.js' %}"></script>
    <script src="{% static 'js/datatables-searchpanes/js/searchPanes.bootstrap4.min.js' %}"></script>
    <script src="{% static 'js/datatables-searchpanes/js/dataTables.searchPanes.js' %}"></script>
    <script src="{% static 'js/datatables-select/js/dataTables.select.min.js' %}"></script>

    <!-- AdminLTE App -->


    <!-- Page specific script -->
    <script>
        function getData (){
        $(function () {
            $("#tabla_entradas").DataTable({
                dom: 'frtipP',
                language: {
                    url: '{% static "fonts/spanish.json" %}'
                },
                "order": [[ 2,"asc" ]],
                "responsive": true, "lengthChange": true, "autoWidth": false,
            }).buttons().container().appendTo('#example1_wrapper .col-md-6:eq(0)');
         });
        }
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

      /****Capturando valores por el id para agregar****/
        d = document;
        const form_add_name = d.getElementById("form_agregar");
        const no_registro_doc = d.getElementById("id_no_registro");
        const no_entrada_doc = d.getElementById("id_no_entrada");
        const titulo = d.getElementById("id_titulo");
        const f_entrada_registro = d.getElementById("id_f_entrada_registro");
        const organismo = d.getElementById("id_organismo");
        const entidad = d.getElementById("id_entidad");
        const tipo_documento = d.getElementById("id_t_documento");
        const observaciones = d.getElementById("id_observaciones");
        const provincia = d.getElementById("id_provincia");
        const no_entrada = no_registro_doc.value;
        {% if no_registro.no_registro%}
            let last = {{ no_registro.no_registro}}
                {% else %}
            let last = 0;
        {% endif %}
        console.log(last);
        const form = d.getElementById("myFormId");
        const $form = d.getElementById('form_agregar');
        const tabla = d.getElementById('#tabla_entradas');

        /****Capturando id para pasarle valores para el form editar****/
        const input_no_entrada = d.getElementById("id_edit_no_entrada");
        const input_no_registro = d.getElementById("id_edit_no_registro");
        const input_titulo = d.getElementById("id_edit_titulo");
        const input_f_entrada = d.getElementById("id_edit_f_entrada_registro");
        const input_organismo = d.getElementById("id_edit_organismo");
        const input_entidad = d.getElementById("id_edit_entidad");
        const input_t_documento = d.getElementById("id_edit_t_documento");
        const input_observaciones = d.getElementById("id_edit_observaciones");
        const input_provincia = d.getElementById("id_edit_provincia");


        /* d.addEventListener('click', ev => {
             if (ev.target.matches(".btn-floating .fa-edit ")) {
                 const $btn_edit = ev.target;
                 const $alltr = $btn_edit.closest('tr');
                 const todos = $alltr.querySelectorAll('td');
                 console.log(todos);
                 const input_no_entrada = d.getElementById("id_no_entrada_doc");
                 const input_titulo = d.getElementById("id_titulo");
                 const input_f_entrada = d.getElementById("id_f_entrada_doc");
                 const input_dirigido = d.getElementById("id_dirigido");
                 const input_organismo = d.getElementById("id_organismo");
                 const input_entidad = d.getElementById("id_entidad");
                 const input_t_documento = d.getElementById("id_t_documento");
                 const input_observaciones = d.getElementById("id_observaciones");
                 input_no_entrada.value = todos[0].innerText;
                 input_titulo.value = todos[1].innerText;
                 input_f_entrada.dataset = todos[2].innerHTML;
                 input_dirigido.value = todos[5].innerHTML;
                 input_organismo.value = 4;
                 input_entidad.value = todos[4].innerText;
                 input_t_documento.value = todos[6].innerText;
                 input_observaciones.value = todos[7].innerText;
                 console.log(input_no_entrada.value)
             }
         })*/

        const EnviarForm = () => {
            d.addEventListener("submit", ev => {
                ev.preventDefault();
                /****Capturando valores para el envio del formulario de agregar documento****/
                var fd_add;
                fd_add = new FormData;
                fd_add.append('ccsrfmiddlewaretoken', getCookie("csrftoken"));
                fd_add.append('titulo', titulo.value);
                fd_add.append('no_registro', no_registro_doc.value);
                fd_add.append('no_entrada_doc', no_entrada_doc.value);
                fd_add.append('f_entrada_registro', f_entrada_registro.value);
                fd_add.append('organismo', organismo.value);
                fd_add.append('entidad', entidad.value);
                fd_add.append('tipo_documento', tipo_documento.value);
                fd_add.append('observaciones', observaciones.value);
                fd_add.append('provincia', provincia.value);

                if (last >= no_entrada.value) {
                    Swal.fire(
                          'Error!',
                          'Existe un error en el número de entrada',
                          'error'
                        )
                } else if (last + 1 < no_entrada.value) {
                     Swal.fire(
                          'Error!',
                          'Existe un error en el número de entrada',
                          'error'
                        )
                } else {
                    const msg = 'Documento agregado';
                    const request = new Request(
                        {% url 'nuevo_entrada_registro' %},
                        {
                            headers: {'X-CSRFToken': getCookie("csrftoken")},
                            'Accept': 'application/json, application/xml, text/plain, text/html, *.*',
                            'Content-Type': 'x-www-form-urlencoded'
                        }
                    );
                    fetch(request, {
                        method: 'post',
                        mode: 'same-origin',
                        body: fd_add,

                    })
                        .then(response => response.json())
                        .then(data => {
                            Swal.fire({
                              icon: 'success',
                              title: 'Documento guardado exitosamente',
                              showConfirmButton: true,
                        }).then(function () {
                            location.reload()
                            })
                        })
                        .catch((error) => {
                            console.log(error);
                            Swal.fire({
                              icon: 'error',
                              title: 'Oops...',
                              text: 'Algo salió mal!',
                              footer: error
                                })
                        });
                }
            });
        };


        const handleEdit = () => {
            d.addEventListener("click", ev => {
                let fn;
                if (ev.target.matches(".btn-floating .fa-edit ")) {
                    const $btn_edit = ev.target,
                        $alltr = $btn_edit.closest('tr'),
                        todos = $alltr.querySelectorAll('td');
                    fn = new FormData;
                    fn.append('ccsrfmiddlewaretoken', getCookie("csrftoken"));
                    fn.append('registro', todos[0].innerText);
                       console.log(todos[0].innerText)
                    const request = new Request(
                        {% url 'editar_entradas_registro' %},
                        {
                            headers: {'X-CSRFToken': getCookie("csrftoken")},
                            'Accept': 'application/json, application/xml, text/plain, text/html, *.*',
                            'Content-Type': 'x-www-form-urlencoded'
                        }
                    );
                    fetch(request, {
                        method: 'POST',
                        mode: 'same-origin',
                        body: fn,

                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log(data)
                            input_no_entrada.value = data['no_entrada_doc'];
                            input_no_entrada.value = data['no_registro'];
                            input_titulo.value = data['titulo'];
                            input_f_entrada.value = data['f_entrada_registro'];
                            input_organismo.value = data['organismo'];
                            input_entidad.value = data['entidad'];
                            input_t_documento.value = data['tipo_documento'];
                            input_observaciones.value = data['observaciones'];
                            input_provincia.value = data['provincia'];



                        })
                        .catch((error) => {
                            console.log(error);
                        });

                }
            });
        };

        const handleSubmitEdit = () => {
            d.addEventListener("click", ev => {
                if(ev.target.matches(".btn-outline-success")){
                    let fd_edit;
                    fd_edit = new FormData;
                    fd_edit.append('ccsrfmiddlewaretoken', getCookie("csrftoken"));
                    fd_edit.append('action','editar');
                    fd_edit.append('titulo', input_titulo.value);
                    fd_edit.append('no_entrada_doc', input_no_entrada.value);
                    fd_edit.append('f_entrada_doc', input_f_entrada.value);
                    fd_edit.append('dirigido', input_dirigido.value);
                    fd_edit.append('organismo', input_organismo.value);
                    fd_edit.append('entidad', input_entidad.value);
                    fd_edit.append('tipo_documento', input_t_documento.value);
                    fd_edit.append('observaciones', input_observaciones.value);
                    fd_edit.append('forma_entrada', input_f_entrada_doc.value);
                    fd_edit.append('soporte_doc', input_soporte_doc.value);
                    fd_edit.append('provincia', input_provincia.value);
                    fd_edit.append('f_termino', input_f_termino.value);
                    fd_edit.append('f_dirigido', input_f_dirigido.value);
                    const request = new Request(
                        {% url 'editar_entradas_registro' %},
                        {
                            headers: {'X-CSRFToken': getCookie("csrftoken")},
                            'Accept': 'application/json, application/xml, text/plain, text/html, *.*',
                            'Content-Type': 'x-www-form-urlencoded'
                        }
                    );
                    fetch(request, {
                        method: 'post',
                        mode: 'same-origin',
                        body: fd_edit,

                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log(data);
                            Swal.fire({
                              icon: 'success',
                              title: 'Documento editado exitosamente',
                              showConfirmButton: true,
                        }).then(function () {
                            location.reload()
                            });


                        })
                        .catch((error) => {
                            console.log(error);
                        });
                }

            });

        }



        const handleDelete = () =>{
            console.log("dentroo")
            d.addEventListener("click", ev => {
                let fd;
                if(ev.target.matches(".btn-outline-danger ") || (ev.target.matches(".fa-trash"))){
                    Swal.fire({
                      title: 'Desea eliminar el documento?',
                      text: "Si acepta no se podrá revertir el proceso",
                      icon: 'warning',
                      showCancelButton: true,
                      confirmButtonColor: '#3085d6',
                      cancelButtonColor: '#d33',
                      confirmButtonText: 'Si, elimínalo!',
                      cancelButtonText: "Cancelar",
                    }).then((result) => {
                      if (result.isConfirmed) {
                          const $btn_delete = ev.target,
                            $alltr = $btn_delete.closest('tr'),
                            todos = $alltr.querySelectorAll('td');

                           fd = new FormData;
                           fd.append('ccsrfmiddlewaretoken', getCookie("csrftoken"));
                           fd.append('entrada', todos[0].innerText);
                            const request = new Request(
                                {% url 'eliminar_entradas_registro' %},
                                {
                                    headers: {'X-CSRFToken': getCookie("csrftoken")},
                                    'Accept': 'application/json, application/xml, text/plain, text/html, *.*',
                                    'Content-Type': 'x-www-form-urlencoded'
                                }
                            );
                            fetch(request, {
                                method: 'POST',
                                mode: 'same-origin',
                                body: fd,

                            })
                                .then(response => response.json())
                                .then(data => {
                                    console.log(data);
                                    Swal.fire({
                                       icon: 'success',
                                       title: 'Documento eliminado exitosamente',
                                       showConfirmButton: true,
                                        }).then(function () {
                                         location.reload()
                                        });

                                })
                                .catch((error) => {
                                    console.log(error);
                                });

                      }
                    })

                }
            })
        };


        d.addEventListener("DOMContentLoaded", () => {
            getData();
            EnviarForm();
            handleEdit();
            handleSubmitEdit();
            handleDelete()
        });


    </script>
{% endblock %}
</body>
